<input type="hidden" name="action" value="ManageGroup">
<div class="content-element">
    <div class="content-header">
        <div class="content-title left">Gruppeneinsendungen verwalten</div>
        <?php if ($isLeader): ?>
        <button class="right text-button info-color bold">speichern</button>
        <?php endif; ?>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <div class="content-description">
                <?php if ($isLeader): ?>
                Wählen Sie für jede Aufgabe aus, welche Einsendung der verschiedenen
                Gruppenmitglieder jeweils kontrolliert werden soll.
                <?php else: ?>
                Hier sehen Sie die Einsendungen der Gruppe, welche kontrolliert werden
                sollen. Nur der Gruppenführer kann Einsendungen auswählen.
                <?php endif; ?>
            </div>
            <?php
            /**
             * @todo Include sub-exercises
             */
            // bool if subtasks are printed
            $isSubtask = false;

            foreach ($exercises as $key => $exercise):
                $hasSelectedSubmissions = false;
                $noSubmission = true;

                // prints exercise title
                print '<div class="group-exercise-title bold new-line">';
                print 'AUFGABE ' . $exercise['link'];
                // if next exercise is not main or is main but current one is subexercise or end is reached but current one is subex.
                if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] != 1) ||
                    (isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
                    (isset($exercises[$key+1]) == false && $isSubtask == true)):
                    // print subtask letter
                    print chr(96+$exercise['linkName']);
                    $isSubtask = true;
                endif;
                print '</div>';

                if (!empty($exercise['groupSubmissions'])):
                    $exerciseID = $exercise['id'];
                    foreach ($exercise['groupSubmissions'] as $userExerciseSubmission):
                        $submission = $userExerciseSubmission['submission'];
                        $user = $userExerciseSubmission['user'];

                        if ($submission['hideFile'] == "0"):
                            if ($isLeader || isset($submission['selectedForGroup'])):
                                $noSubmission = false;
                                print '<div class="left radio new-line">';
                                if ($isLeader):
                                    // prints a radio button for setting the submission as selected
                                    // (group leaders only)
                                    print '<input type="radio" name="';
                                    print 'exercises[' . $exerciseID . ']';
                                    print '" id="';
                                    print $exerciseID;
                                    print '"';
                                    print isset($submission['selectedForGroup']) ? ' checked="checked"' : NULL;
                                    print '" value="';
                                    print $submission['id'];
                                    print '" />';
                                else:
                                    $hasSelectedSubmissions = true;
                                endif;
                                print '</div>';

                                // prints the name of the member
                                print '<div class="group-member-name left">';
                                
                                if (isset($user['firstName'])){
                                    print $user['firstName'];
                                } else
                                    print "";
                                print " ";
                                if (isset($user['lastName'])){
                                    print $user['lastName'];
                                } else
                                    print "";
                                
                                if (isset($user['userName'])){
                                    print " (".$user['userName'].")";
                                } else
                                    print "???";
                                print " ";

                                $displayName = $submission['file']['displayName'];
                                $fileAddress = $submission['file']['address'];
                                $fileSize = $submission['file']['fileSize'];
                                $date = $submission['date'];

                                // prints a link for downloading the submission
                                $fileURL = '../FS/FSBinder/' . $fileAddress . '/' . $displayName;
                                print '<div class="plain exercise-sheet-images">';
                                print '<span class="body-option-color">';
                                print '<a href="'.$fileURL.'" title="'.$displayName.'" class="plain" target="_blank">';
                                print '        <img src="Images/Download.png" />';
                                print ' (' . formatBytes($fileSize) . ') ';
                                print '</a>';
                                print '</span>';
                                print '</div>';
                                print '</div>';
                            endif;
                        endif;
                    endforeach;
                endif;

                if ((!$hasSelectedSubmissions && !$isLeader) || $noSubmission):
                    print '<div class="left radio new-line">';
                    print 'Keine ausgewählten Einsendungen vorhanden.';
                    print '</div>';
                elseif (empty($exercise['groupSubmissions']) || $noSubmission):
                    print '<div class="left radio new-line">';
                    print 'Keine Einsendungen vorhanden.';
                    print '</div>';
                endif;
                // set isSubtask to false if next exercise is a new mainexercise or end of exercises is reached
                if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
                    (isset($exercises[$key+1]) == false && $isSubtask == true)):
                    $isSubtask = false;
                endif;
            endforeach; 
            ?>
        </div>
    </div> <!-- end: content-body-wrapper -->
</div> <!-- end: content-element -->