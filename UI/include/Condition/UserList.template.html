<?php
    $fileName = "Condition.php";
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left uppercase">Studentenliste</div>
        <div class="info-color bold right">
            <a href="<?php echo $fileName; ?>?downloadConditionCsv=<?php echo $user['courses'][0]['course']['id']; ?><?php echo (isset($sortby)?'&sortby='.$sortby:'')?><?php echo (isset($sortId)?'&sortId='.$sortId:'')?>" class="download text-button body-option-color">
                CSV
            </a>
            <a href="<?php echo $fileName; ?>?downloadConditionPdf=<?php echo $user['courses'][0]['course']['id']; ?><?php echo (isset($sortby)?'&sortby='.$sortby:'')?><?php echo (isset($sortId)?'&sortId='.$sortId:'')?>" class="download text-button body-option-color">
                PDF
            </a>
        </div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <?php
                if (isset($users[0])) {
            ?>
            <table>
                <tr class="bold">
                    <th>
                        <?php
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=firstName">Vorname</a>';
                        ?>
                    </th>
                    <th>
                        <?php
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=lastName">Nachname</a>';
                        ?>
                    </th>
                    <th>
                        <?php
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=userName">Nutzername</a>';
                        ?>
                    </th>
                    <!--<th>
                        <?php
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=studentNumber">Matrikel</a>';
                        ?>
                    </th>-->
                    <th>
                        <?php
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=isApproved">Zulassung</a>';
                        ?>
                    </th>
                    <?php
                        // prints all exercise types as header
                        foreach ($minimumPercentages as $percentage) {
                            print "<th colspan=\"2\">";
                            print '<a class="body-option-color plain" href="';
                            print $fileName;
                            print '?cid=';
                            print $user['courses'][0]['course']['id'];
                            print '&sortby=type&sortId='.$percentage['exerciseTypeId'].'">';
                            print $percentage['exerciseType'] . " (max. " . $percentage['maxPoints'] . "P)";
                            print '</a>';
                            print "</th>";
                        }
                    ?>
                </tr>
                <?php
                    // creates a table row for each student
                    foreach ($users as $user) {
                        print "<tr>";

                        // firstName
                        print "<td>";
                        if (isset($user['firstName']))
                            print $user['firstName'];
                        print "</td>";

                        // lastName
                        print "<td>";
                        if (isset($user['lastName']))
                            print $user['lastName'];
                        print "</td>";
                        
                        // userId
                        print "<td>";
                        if (isset($user['userName']))
                            print $user['userName'];
                        print "</td>";
                        
                        // studentNumber
                        /*print "<td>";
                        if (isset($user['studentNumber']))
                            print $user['studentNumber'];
                        print "</td>";*/

                        // isApproved for all courses
                        print "<td";
                        print $user['isApproved']?"":" class=\"critical-color\"";
                        print ">";
                        print $user['isApproved']?"Ja":"Nein";
                        print "</td>";

                        // percentage for each exerciseType
                        foreach ($user['percentages'] as $percentage) {

                                // achieved percentage and points
                                print "<td";
                                print $percentage['isApproved']?"":" class=\"critical-color\"";
                                print ">";
                                print $percentage['percentage'] . "%";
                                print "</td>";
                                print "<td>";
                                print "(" . $percentage['points'] . "P)";
                        }
                        print "</tr>";
                    }
                ?>
            </table>
            <?php
                }
            else {
                print "Es sind noch keine Daten vorhanden.";
            }
            ?>
        </div>
    </div> <!-- end: content-body -->
</div> <!-- end: content-wrapper -->