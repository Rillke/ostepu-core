<?php
foreach ($sheets as $sheet):
?>

<div class="content-element collapsible">
    <div class="content-header">
        <div class="content-title left uppercase">
            <?php print $sheet['sheetName']; ?>
        </div>
        <div class="critical-color bold right">
            <?php print date('d.m.Y  -  H:i', $sheet['endDate']); ?>
        </div>
        <div class="exercise-sheet-info info-color bold right">
            <?php print $sheet['percentage'] . '%'; ?>
        </div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <ol class="exercise-list">
                <?php
                foreach ($sheet['exercises'] as $exercise):
                ?>
                <li>

                    <div class="exercise-type">
                        <?php print $exercise['type']; ?>
                    </div>

                    <div class="exercise-points">
                        <?php
                            if(isset($exercise['submission']['marking'])) {
                                print $exercise['submission']['marking']['points'];
                            }
                            else {
                                print "-";
                            }
                            print ' / ' . $exercise['maxPoints'] . ' P';
                        ?>
                    </div>

                    <div class="exercise-sheet-images">
                        <a href="Upload.php" class="inline">
                            <img src="Images/Upload.png" />
                        </a>
                        <?php 
                            if(isset($exercise['submission'])) {
                                $displayName = $exercise['submission']['file']['displayName'];
                                $fileAddress = $exercise['submission']['file']['address'];
                                $fileURL = $filesystemURI . $fileAddress . '/' . $displayName;

                                print '<a href="';
                                print $fileURL;
                                print '" title="';
                                print $displayName;
                                print '" class="plain" target="_blank">';
                                print '<img src="Images/Download.png" />';
                                print '</a>';
                            }
                        ?>
                        <?php 
                            if(isset($exercise['submission']['marking'])) {
                                $displayName = $exercise['submission']['marking']['file']['displayName'];
                                $fileAddress = $exercise['submission']['marking']['file']['address'];
                                $fileURL = $filesystemURI . $fileAddress . '/' . $displayName;

                                print '<a href="';
                                print $fileURL;
                                print '" title="';
                                print $displayName;
                                print '" class="plain" target="_blank">';
                                print '<img src="Images/DownloadCorrection.png" />';
                                print '</a>';
                            }
                        ?>

                        <a href="#" class="plain"><img src="Images/Attachment.png" /></a>

                        <?php if(isset($exercise['submission'])) { ?>
                            <a href="#" class="plain"><img src="Images/Delete.png" /></a>
                        <?php } ?>
                    </div>
                </li>
                <?php
                endforeach;
                ?>
            </ol>
        </div>

        <div class="content-body right">
            <ol class="body-options body-option-color">
                <li>
                    <?php 
                        $displayName = $sheet['sheetFile']['displayName'];
                        $fileAddress = $sheet['sheetFile']['address'];
                        $fileURL = $filesystemURI . $fileAddress . '/' . $displayName; 
                    ?>
                    <a href="<?= $fileURL ?>" title="<?= $displayName ?>" target="_blank">
                        Aufgabenblatt
                    </a>
                </li>
                <li>
                    <?php
                        /**
                         * @todo Check date and hide sampleSolution, if necessary
                         */
                        $displayName = $sheet['sampleSolution']['displayName'];
                        $fileAddress = $sheet['sampleSolution']['address'];
                        $fileURL = $filesystemURI . $fileAddress . '/' . $displayName; 
                    ?>
                    <a href="<?= $fileURL ?>" title="<?= $displayName ?>" target="_blank">
                        Musterlösung
                    </a>
                </li>
                <li>
                    <a href="Group.php?sid=<?= $sheet['id'], '&cid=', $cid ?>">
                        Gruppe verwalten
                    </a>
                </li>
                <li><a href="#">Alle Anhänge herunterladen</a></li>
                <li><a href="#">Alle Einsendungen herunterladen</a></li>
            </ol>
        </div>
    </div> <!-- end: content-body-wrapper -->

    <?php
        /**
         * @todo isset($sheet['group']['members']) doesn't work ...
         */
        if (isset($sheet['group']['members'])) {
            print '<div class="content-footer">';
            print '<ol>';
            print '<li class="footer-text bold">In Gruppe mit:</li>';
            foreach ($sheet['group']['members'] as $member):
                print '<li class="footer-text">';
                print $member['firstName'] . $member['lastName'];
                print '</li>';
            endforeach;
            print '</ol>';
            print '</div>';
        }
    ?>
</div> <!-- end: content-element -->
<?php
endforeach;
?>
