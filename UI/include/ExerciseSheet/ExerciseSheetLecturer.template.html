<input type="hidden" name="action" value="ExerciseSheetLecturer">
<div class="content-element interactive add">
    <div class="content-header">
        <div class="content-title left uppercase">Neue Serie</div>
        <div class="info-color bold right">
            <?php print "<a href=\"CreateSheet.php?cid={$cid}\" class=\"exercise-sheet-end bold right\" id=\"target\">Serie anlegen</a>"; ?>
        </div>
    </div>
</div> <!-- end: content-element -->

<?php
if (!empty($sheets)) {
foreach ($sheets as $sheet):

    /**
     * @todo Date check needs more testing.
     */

    // bool if endDate of sheet is greater than the actual date
    $isExpired = date('U') > date('U', $sheet['endDate']);
?>
<div class="content-element collapsible">
    <div class="content-header">
        <div class="content-title left uppercase">
            <?php
                print $sheet['sheetName'];
                if ($isExpired) {
                    print ' (abgelaufen)';
                }
            ?>
        </div>
        <div class="critical-color bold right">
            <?php print date('d.m.Y  -  H:i', $sheet['endDate']); ?>
        </div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <ol class="exercise-list">
                <?php
                // bool if subtasks are printed
                $isSubtask = false;
                foreach ($sheet['exercises'] as $key => $exercise):
                ?>
                <?php
                // make a sublist if next exercise is not a main exercise
                if (isset($sheet['exercises'][$key+1]) && $sheet['exercises'][$key+1]['linkName'] != 1 && $isSubtask == false) {
                    $isSubtask = true;
                    print "<li class=\"subexercise-list\"><ol>";
                }
                ?>
                <li>
                    <div class="exercise-type">
                        <?php
                            print $exercise['typeName'];
                            print $exercise['bonus'] ? ' (*)' : NULL;
                        ?>
                    </div>
                    <div class="exercise-points">
                        <?php print $exercise['maxPoints'] . ' P'; ?>
                    </div>
                    <?php
                        // creates a downloadAttachment icon for the exercise (if it exists)
                        if(isset($exercise['attachments'][0])) {
                            print '<div class="exercise-sheet-images">';

                            $displayName = $exercise['attachments'][0]['displayName'];
                            $fileAddress = $exercise['attachments'][0]['address'];
                            $fileURL = $filesystemURI . '/' . $fileAddress . '/' . $displayName;

                            print '<a href="';
                            print $fileURL;
                            print '" title="';
                            print $displayName;
                            print '" class="plain" target="_blank">';
                            print '<img src="Images/Attachment.png" />';
                            print '</a>';

                            print '</div>';
                        }
                    ?>
                </li>
                <?php
                // close subexerciselist if next exercise is a new mainexercise or end of exercises is reached
                if (isset($sheet['exercises'][$key+1]) && $sheet['exercises'][$key+1]['linkName'] == 1 && $isSubtask == true) {
                    $isSubtask = false;
                    print "</ol></li>";
                } elseif (isset($sheet['exercises'][$key+1]) == false && $isSubtask == true) {
                    $isSubtask = false;
                    print "</ol></li>";
                }
                ?>
                <?php endforeach; ?>
            </ol>
        </div>
        <div class="content-body right">
            <ol class="body-options body-option-color">
                <li>
                    <?php $displayName = $sheet['sheetFile']['displayName']; ?>
                    <?php $fileAddress = $sheet['sheetFile']['address']; ?>
                    <?php $fileURL = $filesystemURI . '/' . $fileAddress
                                                    . '/' . $displayName; ?>
                    <a href="<?php echo $fileURL; ?>" title="<?php echo $displayName; ?>"
                        target="_blank">
                        Aufgabenblatt
                    </a>
                </li>
                <?php if (isset($sheet['sampleSolution'])): ?>
                    <li>
                        <?php $displayName = $sheet['sampleSolution']['displayName']; ?>
                        <?php $fileAddress = $sheet['sampleSolution']['address']; ?>
                        <?php $fileURL = "{$filesystemURI}/{$fileAddress}/{$displayName}"; ?>
                        <a href="<?php echo $fileURL; ?>" title="<?php echo $displayName; ?>" target="_blank">
                            Musterlösung
                        </a>
                    </li>
                <?php endif; ?>
                <li><!--<a href="CreateSheet.php">--> <a style="color:#b9b8b8"><s>Serie bearbeiten</s></a></li>
                <?php
                    if ($sheet['hasAttachments']) {
                        print '<li>';
                        print '<button name="downloadAttachments" value="';
                        print $sheet['id'];
                        print '" class="text-button body-option-color">';
                        print 'Alle Anhänge herunterladen';
                        print '</button>';
                        print '</li>';
                    }
                ?>
                <?php
                    print '<li>';
                    print '<button name="downloadCSV" value="';
                    print $sheet['id'];
                    print '" class="text-button body-option-color">';
                    print 'Einsendungen herunterladen';
                    print '</button>';
                    print '</li>';
                ?>
                <li>
                    <a style="color:#b9b8b8"><s>
                   <!-- <a href="TutorUpload.php?cid=<?php echo $user['courses'][0]['course']['id'],
                                                     '&sid=',
                                                     $sheet['id']; ?>">-->
                        Korrekturen hochladen
                   </s></a>
                </li>
                <li>
                    <a href="TutorAssign.php?cid=<?php echo $user['courses'][0]['course']['id'],
                                                     '&sid=',
                                                     $sheet['id']; ?>">
                        Kontrolleurzuweisung
                    </a>
                </li>
                <li>
                    <a href="MarkingTool.php?cid=<?php echo $user['courses'][0]['course']['id'],
                                                     '&sid=',
                                                     $sheet['id']; ?>">
                        Korrekturassistent
                    </a>
                </li>
            </ol>
        </div>
    </div>

    <div class="content-footer">
        <?php 
            /**
             * @todo The way how courseUserCount is calculated needs to be changed in GetSite because
             *       it does not show the possible number of submissions. 
             */
        ?>
        <ol>
            <li class="footer-text bold" style="color:#b9b8b8"><s>Einsendungen:</s></li>
            <li class="footer-text" style="color:#b9b8b8"><s><?php echo $sheet['courseUserCount']; ?> Studenten</s></li>
            <li class="footer-text" style="color:#b9b8b8"><s><?php echo $sheet['studentsWithSubmissionCount']; ?> mit Einsendungen</s></li>
            <li class="footer-text" style="color:#b9b8b8"><s><?php echo $sheet['studentsWithoutSubmissionCount']; ?> ohne Einsendungen</s></li>
        </ol>
    </div> <!-- end: content-body-wrapper -->
</div> <!-- end: content-element -->
<?php 
endforeach;
} else {
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left uppercase">Hinweis</div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            Es sind noch keine Aufgabenblätter vorhanden.
        </div>
    </div> <!-- end: content-body -->
</div> <!-- end: content-wrapper -->
<?php
}
?>