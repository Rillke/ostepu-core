<form action="Upload.php?cid=<?php echo $cid; ?>&sid=<?php echo $sid; ?>" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="action" value="submit">
    <button class="submit" type="submit" name="submit" id="submitButton">
        <div class="content-element">
            <div class="content-header">
                <div class="content-title left uppercase">alle absenden</div>
                <div class="info-color bold right">
                    <a href="javascript:void(0);"
                       class="add-exercise"
                       id="function">
                      alle absenden
                    </a>
                </div>
            </div>
        </div> <!-- end: content-wrapper -->
    </button>

    <?php     
    // bool if subtasks are printed
    $isSubtask = false;
    foreach($exercises as $key => $exercise): 
    ?>
        <div class="content-element">
            <div class="content-header">
                <div class="content-title left">
                    AUFGABE <?php echo $exercise['link']; ?><?php
                    $add="";
                    // if next exercise is not main or is main but current one is subexercise or end is reached but current one is subex.
                    if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] != 1) ||
                        (isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
                        (isset($exercises[$key+1]) == false && $isSubtask == true)) {
                        print chr(96+$exercise['linkName']);
                        $add=chr(96+$exercise['linkName']);
                        $isSubtask = true;
                    }
                    ?>
                    <input type="hidden"
                           name="exercises[<?php echo $key; ?>][name]"
                           value="<?php echo $exercise['link'].$add;?>">
                </div>
                <button class="text-button info-color bold right">
                  alle absenden
                </button>
            </div>
            <div class="content-body-wrapper">
                <div class="content-body left">
                <?php if (isset($exercise['selectedSubmission']) && $exercise['selectedSubmission']['hideFile'] == "0"): ?>
                            <div class="form-field wider left bold new-line">
                                bisherige Einsendung:
                            </div>

                            <?php $sub = $exercise['selectedSubmission']; ?>
                            <?php $file = $sub['file']; ?>
                            <?php $displayName = $file['displayName']; ?>
                            <?php $fileAddress = $file['address']; ?>
                            <?php $date = $sub['date']; ?>
                            <?php $fileURL = "../FS/FSBinder/{$fileAddress}/{$displayName}"; /*{$filesystemURI}*/?>

                            <a href="<?php echo $fileURL; ?>"
                               title="<?php echo $displayName; ?>"
                               class="left body-option-color"
                               target="_blank">
                                Herunterladen (
                                <?php echo date('d.m.Y  -  H:i', $date); ?>,
                                <?php echo formatBytes($file['fileSize']); ?>
                                )
                            </a>

                            <?php if (isset($sub['comment'])): ?>
                                <br><div class="form-field wider left bold new-line">
                                    Kommentar der bisherigen Einsendung:
                                </div> <br />
                                <input type="text"
                                        class="left wider form-field text-input"
                                        value="<?php echo $sub['comment']; ?>"
                                        disabled/>
                            <?php endif; ?>
                            <br><br>
                    <?php endif; ?>
                    
                    <?php
                    if (isset($exercise['form'])){
                        $form = $exercise['form'];
                    ?>
                    
                    <?php if ($form->getTask()!==null){?>
                    <!--<br><br>-->
                    <label class="short label bold" for="task">Aufgabenstellung:</label>

            <div class="content-description left new-line" style="width:748px">
                <?php
                echo str_replace(array(' ', "\n"), array('&nbsp', '<br>'), $form->getTask());
                ?>
            </div>
            <?php }?>
            
                    <?php
                    if ($form->getType()==0){
                    ?>
                    
            <label class="short left label bold" for="answer">Antwort:</label>
            <input type="text" maxlength="250" class="form-field text-input new-line" style="width:748px" name="<?php echo "exercises[".$key."][choices][{$form->getFormId()}][0]"; ?>" placeholder="Antwort"/>    
            <br><br>
            
                    <?php
                    } elseif ($form->getType()==1){
                    ?>
            
            <label class="short left label bold" for="answer">Antwort:</label><br>
                <?php
                    $i=0;
                    foreach ($form->getChoices() as $choice){
                        ?>
                        <div class="form-input-radio new-line" style="width:748px; margin:5px 0px;">
                        <input type="radio" name="<?php echo "exercises[".$key."][choices][{$form->getFormId()}][0]"; ?>" value="<?php echo $choice->getChoiceId(); ?>"/> <?php echo $choice->getText(); ?>
                        </div>                        
                        <?php
                        $i++;
                    }
                ?>                              
<br><br>
                    <?php
                    } elseif ($form->getType()==2){       
                    ?>                    
            
            <label class="short left label bold" for="answer">Antwort:</label><br>
                <?php
                    $i=0;
                    foreach ($form->getChoices() as $choice){
                        ?>
                        <div class="form-input-checkbox new-line" style="width:748px; margin:5px 0px;">
                        <input type="checkbox" name="<?php echo "exercises[".$key."][choices][{$form->getFormId()}][".$i."]"; ?>" value="<?php echo $choice->getChoiceId(); ?>"/> <?php echo $choice->getText(); ?>
                        </div>                        
                        <?php
                        $i++;
                    }
                ?>                              
<br><br>
                    <?php

                    }                    
                    }
                    
                    ?>
                    
                    
                    

                    <label class="short left label bold new-line"
                           for="studentComment">Kommentar:</label>
                    <textarea name="exercises[<?php echo $key; ?>][comment]"
                              class="form-field text-input"
                              rows="5"
                              maxlength="255"></textarea>

                    <?php
                    if (!isset($exercise['form'])){
                    ?>
                    <label class="short left label bold new-line"
                           for="studentComment">Datei:</label>
                    <input type="file"
                           class="button left"
                           name="file<?php echo $exercise['id']; ?>">
                    <?php } ?>
                    <input type="hidden"
                           name="exercises[<?php echo $key; ?>][exerciseID]"
                           value="<?php echo $exercise['id']; ?>">
                </div>
            </div>
        </div>
        <?php
        // set isSubtask to false if next exercise is a new mainexercise or end of exercises is reached
        if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
            (isset($exercises[$key+1]) == false && $isSubtask == true)) {
            $isSubtask = false;
        }
        ?>
    <?php endforeach; ?>

</form>