<input type="hidden" 
       name="maxMarkingStatus" 
       value="<?php echo count($markingStatus) - 1; ?>" />
<?php
    if (!empty($groups)) {
    foreach ($groups as $group):

    $leaderID = $group['leader']['id'];
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left uppercase">
            <?php print $group['leader']['firstName'] . " " . $group['leader']['lastName']; ?>
        </div>
        <div class="info-color bold right">
            <button class="text-button info-color bold right" 
                    name="MarkingTool"
                    value="<?php echo $leaderID; ?>">
                    speichern
            </button>
        </div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <ol class="full-width-exercise-list">
                <?php
                    // bool if subtasks are printed
                    $isSubtask = false;
                    foreach ($group['exercises'] as $key => $exercise):
                    $eid = $exercise['id'];
                ?>
                <?php
                // make a sublist if next exercise is not a main exercise
                if (isset($group['exercises'][$key+1]) && $group['exercises'][$key+1]['linkName'] != 1 && $isSubtask == false) {
                    $isSubtask = true;
                    print "<li class=\"subexercise-list\"><ol>";
                }
                ?>
                <li>
                <input type="hidden" 
                       name="exercises[<?php echo $leaderID; ?>][<?php echo $eid; ?>][maxPoints]" 
                       value="<?php if (isset($exercise['maxPoints'])) echo $exercise['maxPoints']; ?>" />

                <input type="hidden" 
                       name="exercises[<?php echo $leaderID; ?>][<?php echo $eid; ?>][submissionID]" 
                       value="<?php echo isset($exercise['submission']) ? $exercise['submission']['id'] : -1; ?>" />

                <input type="hidden" 
                       name="exercises[<?php echo $leaderID; ?>][<?php echo $eid; ?>][markingID]" 
                       value="<?php echo isset($exercise['submission']['marking']) ? $exercise['submission']['marking']['id'] : -1; ?>" />

                    <?php
                        print '<input class="form-field text-input very-short" name="';
                        print 'exercises[' . $leaderID . '][' . $eid . '][points]" value="';
                        print isset($exercise['submission']['marking']) ? $exercise['submission']['marking']['points'] : 0;
                        print '" id="exercisePoints" />';
                    ?>

                    <div class="form-field label short" for="exercisePoints">
                        <?php
                            print '/ ' . $exercise['maxPoints'] . 'P';
                            print $exercise['bonus'] ? ' (*)' : NULL;
                        ?>
                    </div>

                    <?php
                        print '<input class="form-field text-input" name="';
                        print 'exercises[' . $leaderID . '][' . $eid . '][tutorComment]" value="';
                        if (isset($exercise['submission']['marking']['tutorComment'])) print $exercise['submission']['marking']['tutorComment'];
                        print '" id="markingComment" maxlength="255" />';
                    ?>

                    <select class="form-field text-input short" 
                            name="exercises[<?php echo $leaderID; ?>][<?php echo $eid; ?>][status]" 
                            id="exerciseType"> 
                        <?php
                            foreach ($markingStatus as $status) {
                                if (!isset($status['id'])) continue;
                                if (!isset($status['longName'])) $status['longName'] = '???';
                                
                                print '<option value="';
                                print $status['id'] . '" ';
                                if (isset($exercise['submission']['marking']['status'])) {
                                    print $status['id'] == $exercise['submission']['marking']['status'] ? ' selected="selected"' : NULL;
                                }
                                print '>';
                                print $status['longName'];
                                print '</option>';
                            }
                        ?>
                    </select>

                    <div class="exercise-sheet-images">
                        <?php
                            // creates a download icon for the submission (if it exists)
                            if (isset($exercise['submission'])) {
                                if (!isset($exercise['submission']['hideFile']) || $exercise['submission']['hideFile'] == "0") {
                                    if (isset($exercise['submission']['file']['displayName']) && isset($exercise['submission']['file']['address'])){
                                        $displayName = $exercise['submission']['file']['displayName'];
                                        $fileAddress = $exercise['submission']['file']['address'];
                                        $fileURL = '../FS/FSBinder/' . $fileAddress . '/' . $displayName; //$filesystemURI

                                        print '<a href="';
                                        print $fileURL;
                                        print '" title="';
                                        print $displayName;
                                        print '" class="plain" target="_blank">';
                                        print '<img src="Images/Download.png" />';
                                        print '</a>';
                                    }
                                }
                            }
                        ?>

                        <?php
                            // creates a downloadCorrection icon for the marking (if it exists)
                            if (isset($exercise['submission']['marking'])) {
                                if (!isset($exercise['submission']['marking']['hideFile']) || $exercise['submission']['marking']['hideFile'] == "0") {
                                    if (isset($exercise['submission']['marking']['file']['displayName']) && isset($exercise['submission']['marking']['file']['address'])){
                                        $displayName = $exercise['submission']['marking']['file']['displayName'];
                                        $fileAddress = $exercise['submission']['marking']['file']['address'];
                                        $fileURL = '../FS/FSBinder/' . $fileAddress . '/' . $displayName; //$filesystemURI

                                        print '<a href="';
                                        print $fileURL;
                                        print '" title="';
                                        print $displayName;
                                        print '" class="plain" target="_blank">';
                                        print '<img src="Images/DownloadCorrection.png" />';
                                        print '</a>';
                                    }
                                }
                            }
                        ?>

                        <?php
                            if (isset($exercise['submission']['comment'])){
                                $studentComment = $exercise['submission']['comment'];

                                if (!empty($studentComment)) {
                                    print '<a href="javascript:alert(\'';
                                    print $studentComment;
                                    print '\')" class="body-option-color exercise-comment right">';
                                    print 'Kommentar (Student)';
                                    print '</a>';
                                }
                            }
                        ?>
                </li>
                <?php
                // close subexerciselist if next exercise is a new mainexercise or end of exercises is reached
                if (isset($group['exercises'][$key+1]) && $group['exercises'][$key+1]['linkName'] == 1 && $isSubtask == true) {
                    $isSubtask = false;
                    print "</ol></li>";
                } elseif (isset($group['exercises'][$key+1]) == false && $isSubtask == true) {
                    $isSubtask = false;
                    print "</ol></li>";
                }
                ?>
                <?php endforeach; ?>
            </ol>
        </div>
    </div> <!-- end: content-body -->

    <?php
        // prints a footer list-item for every group member of the sheet
        if (isset($group['members'][0])) {
            print '<div class="content-footer">';
            print '<ol>';
            print '<li class="footer-text bold">Weitere Gruppenmitglieder:</li>';
            foreach ($group['members'] as $member):
                print '<li class="footer-text">';
                print $member['firstName'] . " " . $member['lastName'];
                print '</li>';
            endforeach;
            print '</ol>';
            print '</div>';
        }
    ?>
</div> <!-- end: content-wrapper -->
<?php
endforeach;
} else {
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left uppercase">Ergebnis</div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            Zu Ihrer Auswahl sind keine Einsendungen vorhanden.
        </div>
    </div> <!-- end: content-body -->
</div> <!-- end: content-wrapper -->
<?php
}
?>