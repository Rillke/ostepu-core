<?php 
    // bool if subtasks are printed
    $count=null;
    $namesOfExercises=array();
    $alphabet = range('a', 'z');
    foreach ($exercises as $key => $exercise){
        $exerciseId = $exercise['id'];

        if ($count===null || $exercises[$count]['link'] != $exercise['link']){
            $count=$key;
            $namesOfExercises[$exerciseId] = 'AUFGABE '.$exercise['link'];
            $subtask = 0;
        }else{
            $subtask++;
            $namesOfExercises[$exerciseId] = 'AUFGABE '.$exercise['link'].$alphabet[$subtask];
            $namesOfExercises[$exercises[$count]['id']] = 'AUFGABE '.$exercises[$count]['link'].$alphabet[0];
        }
    }
    
    $isSubtask = false;
    if (isset($submissionHistory))
    foreach ($exercises as $ex):
    $key = $ex['id'];
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left"><?php echo $namesOfExercises[$key];?></div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <?php
                $noSubmission = true;
                if (!empty($submissionHistory[$key])) {
                    foreach ($submissionHistory[$key] as $submission) {
                        if ($submission['hideFile'] == "0") {
                            $noSubmission = false;

                            // prints the submission date
                            print '<div class="form-field left bold new-line">';
                            print date('d.m.Y  -  H:i', $submission['date']);
                            print '</div>';

                            $displayName = $submission['file']['displayName'];
                            $fileAddress = $submission['file']['address'];
                            $fileSize = $submission['file']['fileSize'];

                            // prints the link for downloading the submission
                            print '<a class="left body-option-color" href="';
                            print  '../FS/FSBinder/' . $fileAddress . '/' . $displayName; //$filesystemURI
                            print '" title="';
                            print $displayName;
                            print '" target="_blank">Einsendung ansehen';
                            print ' (' . formatBytes($fileSize) . ') ';
                            print '</a>';
                        }
                    }
                }

                if ($noSubmission) {
                    print 'Keine Einsendungen vorhanden.';
                }
            ?>
        </div>
    </div>
</div>
<?php
    // set isSubtask to false if next exercise is a new mainexercise or end of exercises is reached
    if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
        (isset($exercises[$key+1]) == false && $isSubtask == true)) {
        $isSubtask = false;
    }
    endforeach;
?>