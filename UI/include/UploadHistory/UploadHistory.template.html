<?php 
    // bool if subtasks are printed
    $isSubtask = false;
    if (isset($submissionHistory))
    foreach ($exercises as $ex):
    $key = $ex['id'];
?>
<div class="content-element">
    <div class="content-header">
        <div class="content-title left">AUFGABE <?php
                    if (isset($exercises[$key])) {
                        print $exercises[$key]['link'];
                    }
                    // if next exercise is not main or is main but current one is subexercise or end is reached but current one is subex.
                    if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] != 1) ||
                        (isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
                        (isset($exercises[$key+1]) == false && $isSubtask == true)) {
                        if (isset($exercises[$key])) {
                            print chr(96+$exercises[$key]['linkName']);
                            $isSubtask = true;
                        }
                    }
                    ?></div>
    </div>

    <div class="content-body-wrapper">
        <div class="content-body left">
            <?php
                $noSubmission = true;
                if (!empty($submissionHistory[$key])) {
                    foreach ($submissionHistory[$key] as $submission) {
                        if ($submission['hideFile'] == "0") {
                            $noSubmission = false;

                            // prints the submission date
                            print '<div class="form-field left bold new-line">';
                            print date('d.m.Y  -  H:i', $submission['date']);
                            print '</div>';

                            $displayName = $submission['file']['displayName'];
                            $fileAddress = $submission['file']['address'];
                            $fileSize = $submission['file']['fileSize'];

                            // prints the link for downloading the submission
                            print '<a class="left body-option-color" href="';
                            print  '../FS/FSBinder/' . $fileAddress . '/' . $displayName; //$filesystemURI
                            print '" title="';
                            print $displayName;
                            print '" target="_blank">Einsendung ansehen';
                            print ' (' . formatBytes($fileSize) . ') ';
                            print '</a>';
                        }
                    }
                }

                if ($noSubmission) {
                    print 'Keine Einsendungen vorhanden.';
                }
            ?>
        </div>
    </div>
</div>
<?php
    // set isSubtask to false if next exercise is a new mainexercise or end of exercises is reached
    if ((isset($exercises[$key+1]) && $exercises[$key+1]['linkName'] == 1 && $isSubtask == true) ||
        (isset($exercises[$key+1]) == false && $isSubtask == true)) {
        $isSubtask = false;
    }
    endforeach;
?>